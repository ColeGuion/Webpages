<!DOCTYPE html>
<html>
<head>
    <title>Colors</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Lexend:wght@100..900&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&family=Montserrat:ital,wght@0,100..900;1,100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Proza+Libre:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,500;1,600;1,700;1,800&family=Raleway:ital,wght@0,100..900;1,100..900&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Slab:wght@100..900&family=Roboto:ital,wght@0,100..900;1,100..900&family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="Style/main.css">
    <link rel="stylesheet" href="Style/colors.css">
</head>

<body> 
    <div class="container">
        <div class="lighten-color-tool">
            <h1 class="colHeader" id="color-shade-header">Color Lightener</h1>
            <div class="colorPicker">
                <div>
                    <div class="form-group">
                        <label for="color-inp" class="headFont">Color</label>
                        <input type="text" id="color-inp" value="#cc0000">
                    </div>  
                </div>
                <div><div id="color-block"></div></div>
            </div>
            <div class="flex" id="color-scale">
                <input type="range" id="volume-inp" name="volume" min="0" max="100" class="block self-center" style="width:50%;">
                <span style="width:90px;" class="self-center text-xl font-bold px-3 py-2 bg-gray-100 border text-center rounded ml-3">60%</span>
            </div>

            <h1 class="colHeader" style="margin: 50px 0 20px;">New Color</h1>
            <div class="newColor">
                <div>
                    <div class="form-group">
                        <label for="hex" class="headFont">HEX</label>
                        <input type="text" id="hex">
                    </div>
                    <div class="form-group">
                        <label for="rgb" class="headFont">RGB</label>
                        <input type="text" id="rgb">
                    </div>
                </div>
                <div>
                    <div id="newColor-block"></div>
                </div>
            </div>
        </div>

        <div>
            <div id="BestColors">
                <div class="best-colors">
                    <div style="color: #df6900;"><div class="colorBlk" style="background-color: #DF6900;"></div><span>Orange</span></div>
                    <div style="color: #E20000;"><div class="colorBlk" style="background-color: #E20000;"></div><span>Red</span></div>
                    <div style="color: #2F650C;"><div class="colorBlk" style="background-color: #2F650C;"></div><span>Green</span></div>
                    <div style="color: #9900FF;"><div class="colorBlk" style="background-color: #9900FF;"></div><span>Purple #1</span></div>
                    <div style="color: #800080;"><div class="colorBlk" style="background-color: #800080;"></div><span>Purple #3</span></div>
                </div>
                <div class="best-colors">
                    <div style="color: #FF4500;"><div class="colorBlk" style="background-color: #FF4500;"></div><span>Red-Orange</span></div>
                    <div style="color: #b8860b;"><div class="colorBlk" style="background-color: #B8860B;"></div><span>Yellow</span></div>
                    <div style="color: #188038;"><div class="colorBlk" style="background-color: #188038;"></div><span>Green</span></div>
                    <div style="color: #8300DC;"><div class="colorBlk" style="background-color: #8300DC;"></div><span>Purple #2</span></div>
                    <div style="color: #B200B2;"><div class="colorBlk" style="background-color: #B200B2;"></div><span>Pink</span></div>
                </div>
            </div>
            <div style="display: flex; justify-content: center; align-items: center; padding: 15px;">
                <button class="btn-add-color">Add Color</button>
            </div>
        </div>
    </div>

    <!-- Add Color Popup -->
    <div id="addColorModal">
        <div style="background:white; padding:20px; border-radius:10px; width:300px;">
            <h2>Add a Color</h2>
            <label>Hex Code</label>
            <input id="modal-hex" placeholder="#C6086E" style="width:100%; margin-bottom:10px;">
            
            <label>Name</label>
            <input id="modal-name" placeholder="Deep Pink" style="width:100%; margin-bottom:15px;">
            
            <button id="saveColorBtn">Save</button>
            <button onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <script src="Scripts/color.js"></script>
    <script src="Scripts/navigation.js"></script>

    <script>
    /* ------------------------------------------------------------
    IndexedDB Setup
    ------------------------------------------------------------ */
    let db;
    const request = indexedDB.open("ColorDatabase", 1);

    request.onupgradeneeded = function(event) {
        db = event.target.result;
        const store = db.createObjectStore("colors", { keyPath: "id", autoIncrement: true });
        store.createIndex("hex", "hex", { unique: false });
        store.createIndex("name", "name", { unique: false });
    };

    request.onsuccess = function(event) {
        db = event.target.result;
        loadSavedColors(); // load user-added colors on startup
    };

    request.onerror = function(event) {
        console.log("IndexedDB error:", event.target.error);
    };


    /* ------------------------------------------------------------
    Modal Controls
    ------------------------------------------------------------ */
    document.querySelector(".btn-add-color").onclick = () => {
        document.getElementById("addColorModal").style.display = "flex";
    };

    function closeModal() {
        document.getElementById("addColorModal").style.display = "none";
    }


    /* ------------------------------------------------------------
    Save Color to IndexedDB
    ------------------------------------------------------------ */
    document.getElementById("saveColorBtn").onclick = function() {
        const hex = document.getElementById("modal-hex").value.trim();
        const name = document.getElementById("modal-name").value.trim();

        if (!/^#[0-9A-F]{6}$/i.test(hex)) {
            alert("Invalid HEX code!");
            return;
        }
        if (name.length < 1) {
            alert("Please enter a color name.");
            return;
        }

        const tx = db.transaction("colors", "readwrite");
        const store = tx.objectStore("colors");

        store.add({ hex, name });

        tx.oncomplete = () => {
            addColorToDOM(hex, name);
            closeModal();
            document.getElementById("modal-hex").value = "";
            document.getElementById("modal-name").value = "";
        };
    };


    /* ------------------------------------------------------------
    Load All Saved Colors From DB
    ------------------------------------------------------------ */
    function loadSavedColors() {
        const tx = db.transaction("colors", "readonly");
        const store = tx.objectStore("colors");

        store.openCursor().onsuccess = function(event) {
            const cursor = event.target.result;
            if (cursor) {
                addColorToDOM(cursor.value.hex, cursor.value.name);
                cursor.continue();
            }
        };
    }


    /* ------------------------------------------------------------
    Insert New Color Block Into The Page
    ------------------------------------------------------------ */
    function addColorToDOM(hex, name) {
        // Create div as requested
        const div = document.createElement("div");
        div.style.color = hex;
        div.innerHTML = `
            <div class="colorBlk" style="background-color: ${hex};"></div>
            <span>${name}</span>
        `;

        // Add to one of your existing ".best-colors" sections
        const containers = document.querySelectorAll("#BestColors .best-colors");

        // Add to the container with the LEAST children
        let smallest = containers[0];
        containers.forEach(cont => {
            if (cont.children.length < smallest.children.length) {
                smallest = cont;
            }
        });

        smallest.appendChild(div);

        // Make clicking copy the color (matches your existing behavior)
        const blk = div.querySelector(".colorBlk");
        blk.onclick = () => navigator.clipboard.writeText(hex);
    }
    </script>
</body>
</html>